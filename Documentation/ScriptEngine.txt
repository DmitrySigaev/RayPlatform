``The compile-time script engine in Ray and its applications.''

Authored by SÃ©bastien Boisvert
2012-01-08

The ScriptEngine does a lot of code generation using
compile-time scripting.

== Master mode ordering, master switches and slave switches ==

In the scripting directory, there is a list of ordered master modes.

For each of the master modes, there is an associated MPI tag for the master switch.
In turn, some MPI tags trigger slave switches. See the example below.

Exemple illustrated in 8 triggers:


=== Trigger 1 ===

On the master rank, the master mode is set to RAY_MASTER_MODE_CONTIG_BIOLOGICAL_ABUNDANCES somewhere.
On other ranks, the slave mode is RAY_MASTER_MODE_DO_NOTHING.

=== Trigger 2 ===

The master rank sends to all a message with tag RAY_MPI_TAG_CONTIG_BIOLOGICAL_ABUNDANCES
because there is a master switch for RAY_MASTER_MODE_CONTIG_BIOLOGICAL_ABUNDANCES 
saying to do that in the master switch table.

=== Trigger 3 === 

On the master rank, the master handler table resolves RAY_MASTER_MODE_CONTIG_BIOLOGICAL_ABUNDANCES to
call_RAY_MASTER_MODE_CONTIG_BIOLOGICAL_ABUNDANCES. This handler is called.

=== Trigger 4 ===

On any non-master rank, the master handler table resolves RAY_MASTER_MODE_DO_NOTHING to
call_RAY_MASTER_MODE_DO_NOTHING. This handler is called and it does nothing.

=== Trigger 5 ===

On any rank, the reception of a message with a tag valued to RAY_MPI_TAG_CONTIG_BIOLOGICAL_ABUNDANCES
sets the slave mode to RAY_SLAVE_MODE_CONTIG_BIOLOGICAL_ABUNDANCES because 
it is found in the slave switch table.

=== Trigger 6 ===

The slave mode RAY_SLAVE_MODE_CONTIG_BIOLOGICAL_ABUNDANCES is searched in 
the slave handler table and the handler call_RAY_SLAVE_MODE_CONTIG_BIOLOGICAL_ABUNDANCES
is found. This handler is called.

=== Trigger 7 ===

Upon completion, a slave mode sends to the master rank the MPI tag
RAY_MPI_TAG_SWITCHMAN_COMPLETION_SIGNAL. This is standard procedure.

=== Trigger 8 ===

On the master rank, the received MPI tag RAY_MPI_TAG_SWITCHMAN_COMPLETION_SIGNAL 
triggers call_RAY_MPI_TAG_SWITCHMAN_COMPLETION_SIGNAL. This closes the slave mode
for the source of the message. If all MPI ranks have closed their slave mode,
then the ordered list of master modes is utilised to set the next master mode.
After that, the whole thing starts again (go to Trigger 1).

